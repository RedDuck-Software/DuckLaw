@page "/renderdoc"
@using MudBlazor
@inject Duck.Client.Service.IService serv
@inject NavigationManager NavigationManager
@inject HttpClient client
@inject IJSRuntime js
@using Duck.Shared
@using System.IO
@inject ISnackbar Snackbar
<link href="css/UserForm.css" rel="stylesheet" />
<EditForm Model="render"  OnValidSubmit="Create">
    <div id="login-box">
        <div class="tab-content">
            <div id="home" class="container">
                <div class="form-control-file justify-content-between">
                    <div>
                        <MudPaperc @ondragenter="@(()=>_dragEnterStyle="drag-enter")"
                                   @ondragleave="@(()=>_dragEnterStyle=null)"
                                   @ondragend="@(()=>_dragEnterStyle=null)"
                                   Class=@("drag-drop-zone "+ _dragEnterStyle)>
                            <InputFile OnChange="OnInputFileChanged" multiple class="drag-drop-input" />
                            @if (fileNames.Count() == 0)
                            {
                        <MudText Typo="Typo.h6" Class="text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 511 511" style="enable-background:new 0 0 511 511;" xml:space="preserve" width="80px" height="80px">
<g>
                            <path d="M498.962,102.751c-0.018-0.182-0.049-0.359-0.08-0.537c-0.011-0.063-0.016-0.128-0.029-0.191   c-0.042-0.21-0.096-0.416-0.156-0.619c-0.009-0.03-0.014-0.061-0.023-0.091c-0.063-0.207-0.138-0.409-0.218-0.608   c-0.011-0.027-0.019-0.055-0.03-0.081c-0.078-0.189-0.168-0.372-0.261-0.552c-0.019-0.037-0.034-0.075-0.054-0.112   c-0.09-0.167-0.189-0.327-0.291-0.486c-0.031-0.048-0.057-0.098-0.088-0.145c-0.101-0.151-0.212-0.295-0.324-0.438   c-0.039-0.05-0.073-0.102-0.113-0.151c-0.156-0.189-0.32-0.372-0.493-0.545L400.804,2.198c-0.173-0.173-0.355-0.338-0.545-0.493   c-0.049-0.04-0.101-0.074-0.151-0.113c-0.143-0.112-0.287-0.223-0.438-0.324c-0.047-0.032-0.097-0.058-0.145-0.088   c-0.159-0.101-0.319-0.201-0.486-0.291c-0.036-0.02-0.075-0.035-0.112-0.054c-0.181-0.093-0.364-0.183-0.552-0.261   c-0.027-0.011-0.054-0.019-0.081-0.03c-0.199-0.08-0.401-0.155-0.608-0.218c-0.03-0.009-0.061-0.015-0.091-0.023   c-0.203-0.059-0.409-0.114-0.619-0.156c-0.063-0.013-0.128-0.018-0.191-0.029c-0.177-0.031-0.355-0.062-0.537-0.08   C396.001,0.013,395.751,0,395.5,0h-224C149.72,0,132,17.72,132,39.5V80H43.5C26.131,80,12,94.131,12,111.5v80   c0,17.369,14.131,31.5,31.5,31.5H132v248.5c0,21.78,17.72,39.5,39.5,39.5h288c21.78,0,39.5-17.72,39.5-39.5v-368   C499,103.249,498.987,102.999,498.962,102.751z M403,25.606L473.394,96H427.5C413.991,96,403,85.009,403,71.5V25.606z M27,191.5   v-80c0-9.098,7.402-16.5,16.5-16.5h304c9.098,0,16.5,7.402,16.5,16.5v80c0,9.098-7.402,16.5-16.5,16.5H139.519   c-0.007,0-0.013-0.001-0.019-0.001S139.487,208,139.481,208H43.5C34.402,208,27,200.598,27,191.5z M459.5,496h-288   c-13.509,0-24.5-10.991-24.5-24.5V223h200.5c17.369,0,31.5-14.131,31.5-31.5v-80c0-17.369-14.131-31.5-31.5-31.5H147V39.5   c0-13.509,10.991-24.5,24.5-24.5H388v56.5c0,21.78,17.72,39.5,39.5,39.5H484v360.5C484,485.009,473.009,496,459.5,496z" />
                            <path d="M115.5,112c-4.142,0-7.5,3.358-7.5,7.5V152H67v-32.5c0-4.142-3.358-7.5-7.5-7.5s-7.5,3.358-7.5,7.5v64   c0,4.142,3.358,7.5,7.5,7.5s7.5-3.358,7.5-7.5V167h41v16.5c0,4.142,3.358,7.5,7.5,7.5s7.5-3.358,7.5-7.5v-64   C123,115.358,119.642,112,115.5,112z" />
                            <path d="M211.5,191c4.142,0,7.5-3.358,7.5-7.5v-36.923l10.069,16.782c1.355,2.259,3.797,3.641,6.431,3.641h8   c2.634,0,5.076-1.382,6.431-3.641L260,146.577V183.5c0,4.142,3.358,7.5,7.5,7.5s7.5-3.358,7.5-7.5v-64   c0-3.371-2.249-6.328-5.498-7.228c-3.249-0.9-6.698,0.478-8.433,3.369L239.5,151.589l-21.569-35.948   c-1.734-2.891-5.186-4.267-8.433-3.369c-3.249,0.9-5.498,3.857-5.498,7.228v64C204,187.642,207.358,191,211.5,191z" />
                            <path d="M139.5,127H156v56.5c0,4.142,3.358,7.5,7.5,7.5s7.5-3.358,7.5-7.5V127h16.5c4.142,0,7.5-3.358,7.5-7.5s-3.358-7.5-7.5-7.5   h-48c-4.142,0-7.5,3.358-7.5,7.5S135.358,127,139.5,127z" />
                            <path d="M299.5,191h40c4.142,0,7.5-3.358,7.5-7.5s-3.358-7.5-7.5-7.5H307v-56.5c0-4.142-3.358-7.5-7.5-7.5s-7.5,3.358-7.5,7.5v64   C292,187.642,295.358,191,299.5,191z" />
                            <path d="M341.872,280.385c-3.929-1.309-8.177,0.814-9.487,4.744l-48,144c-1.31,3.929,0.814,8.177,4.744,9.487   c0.787,0.262,1.586,0.387,2.373,0.387c3.14,0,6.066-1.988,7.114-5.13l48-144C347.925,285.942,345.801,281.695,341.872,280.385z" />
                            <path d="M272.803,298.197c-2.929-2.929-7.678-2.929-10.606,0l-56,56c-2.929,2.929-2.929,7.678,0,10.606l56,56   c1.464,1.464,3.384,2.197,5.303,2.197s3.839-0.732,5.303-2.197c2.929-2.929,2.929-7.678,0-10.606L222.106,359.5l50.697-50.697   C275.732,305.875,275.732,301.125,272.803,298.197z" />
                            <path d="M368.803,298.197c-2.929-2.929-7.678-2.929-10.606,0c-2.929,2.929-2.929,7.678,0,10.606l50.697,50.697l-50.697,50.697   c-2.929,2.929-2.929,7.678,0,10.606c1.464,1.464,3.384,2.197,5.303,2.197s3.839-0.732,5.303-2.197l56-56   c2.929-2.929,2.929-7.678,0-10.606L368.803,298.197z" />
</g>
</svg>
                            <br />
                            <br />
                            Перетягніть файли сюди, або
                            <br />
                            <br />

                            <InputFile id="fileInput" OnChange="OnInputFileChanged" hidden multiple />
                            <MudFab HtmlTag="label"
                                    Color="Color.Secondary"
                                    Icon="@Icons.Filled.CloudUpload"
                                    Label="виберіть файл"
                                    Class="btn btn-danger-dark"
                                    for="fileInput" />
                            <br />
                            <br />
                            <svg width="50" height="50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 303.188 303.188" style="enable-background:new 0 0 303.188 303.188;" xml:space="preserve">
<g>
                            <polygon style="fill:#E8E8E8;" points="219.821,0 32.842,0 32.842,303.188 270.346,303.188 270.346,50.525  " />
                            <path style="fill:#FB3449;" d="M230.013,149.935c-3.643-6.493-16.231-8.533-22.006-9.451c-4.552-0.724-9.199-0.94-13.803-0.936   c-3.615-0.024-7.177,0.154-10.693,0.354c-1.296,0.087-2.579,0.199-3.861,0.31c-1.314-1.36-2.584-2.765-3.813-4.202   c-7.82-9.257-14.134-19.755-19.279-30.664c1.366-5.271,2.459-10.772,3.119-16.485c1.205-10.427,1.619-22.31-2.288-32.251   c-1.349-3.431-4.946-7.608-9.096-5.528c-4.771,2.392-6.113,9.169-6.502,13.973c-0.313,3.883-0.094,7.776,0.558,11.594   c0.664,3.844,1.733,7.494,2.897,11.139c1.086,3.342,2.283,6.658,3.588,9.943c-0.828,2.586-1.707,5.127-2.63,7.603   c-2.152,5.643-4.479,11.004-6.717,16.161c-1.18,2.557-2.335,5.06-3.465,7.507c-3.576,7.855-7.458,15.566-11.815,23.02   c-10.163,3.585-19.283,7.741-26.857,12.625c-4.063,2.625-7.652,5.476-10.641,8.603c-2.822,2.952-5.69,6.783-5.941,11.024   c-0.141,2.394,0.807,4.717,2.768,6.137c2.697,2.015,6.271,1.881,9.4,1.225c10.25-2.15,18.121-10.961,24.824-18.387   c4.617-5.115,9.872-11.61,15.369-19.465c0.012-0.018,0.024-0.036,0.037-0.054c9.428-2.923,19.689-5.391,30.579-7.205   c4.975-0.825,10.082-1.5,15.291-1.974c3.663,3.431,7.621,6.555,11.939,9.164c3.363,2.069,6.94,3.816,10.684,5.119   c3.786,1.237,7.595,2.247,11.528,2.886c1.986,0.284,4.017,0.413,6.092,0.335c4.631-0.175,11.278-1.951,11.714-7.57   C231.127,152.765,230.756,151.257,230.013,149.935z M119.144,160.245c-2.169,3.36-4.261,6.382-6.232,9.041   c-4.827,6.568-10.34,14.369-18.322,17.286c-1.516,0.554-3.512,1.126-5.616,1.002c-1.874-0.11-3.722-0.937-3.637-3.065   c0.042-1.114,0.587-2.535,1.423-3.931c0.915-1.531,2.048-2.935,3.275-4.226c2.629-2.762,5.953-5.439,9.777-7.918   c5.865-3.805,12.867-7.23,20.672-10.286C120.035,158.858,119.587,159.564,119.144,160.245z M146.366,75.985   c-0.602-3.514-0.693-7.077-0.323-10.503c0.184-1.713,0.533-3.385,1.038-4.952c0.428-1.33,1.352-4.576,2.826-4.993   c2.43-0.688,3.177,4.529,3.452,6.005c1.566,8.396,0.186,17.733-1.693,25.969c-0.299,1.31-0.632,2.599-0.973,3.883   c-0.582-1.601-1.137-3.207-1.648-4.821C147.945,83.048,146.939,79.482,146.366,75.985z M163.049,142.265   c-9.13,1.48-17.815,3.419-25.979,5.708c0.983-0.275,5.475-8.788,6.477-10.555c4.721-8.315,8.583-17.042,11.358-26.197   c4.9,9.691,10.847,18.962,18.153,27.214c0.673,0.749,1.357,1.489,2.053,2.22C171.017,141.096,166.988,141.633,163.049,142.265z    M224.793,153.959c-0.334,1.805-4.189,2.837-5.988,3.121c-5.316,0.836-10.94,0.167-16.028-1.542   c-3.491-1.172-6.858-2.768-10.057-4.688c-3.18-1.921-6.155-4.181-8.936-6.673c3.429-0.206,6.9-0.341,10.388-0.275   c3.488,0.035,7.003,0.211,10.475,0.664c6.511,0.726,13.807,2.961,18.932,7.186C224.588,152.585,224.91,153.321,224.793,153.959z" />
                            <polygon style="fill:#FB3449;" points="227.64,25.263 32.842,25.263 32.842,0 219.821,0  " />
                            <g>
                            <path style="fill:#A4A9AD;" d="M126.841,241.152c0,5.361-1.58,9.501-4.742,12.421c-3.162,2.921-7.652,4.381-13.472,4.381h-3.643    v15.917H92.022v-47.979h16.606c6.06,0,10.611,1.324,13.652,3.971C125.321,232.51,126.841,236.273,126.841,241.152z     M104.985,247.387h2.363c1.947,0,3.495-0.546,4.644-1.641c1.149-1.094,1.723-2.604,1.723-4.529c0-3.238-1.794-4.857-5.382-4.857    h-3.348C104.985,236.36,104.985,247.387,104.985,247.387z" />
                            <path style="fill:#A4A9AD;" d="M175.215,248.864c0,8.007-2.205,14.177-6.613,18.509s-10.606,6.498-18.591,6.498h-15.523v-47.979    h16.606c7.701,0,13.646,1.969,17.836,5.907C173.119,235.737,175.215,241.426,175.215,248.864z M161.76,249.324    c0-4.398-0.87-7.657-2.609-9.78c-1.739-2.122-4.381-3.183-7.926-3.183h-3.773v26.877h2.888c3.939,0,6.826-1.143,8.664-3.43    C160.841,257.523,161.76,254.028,161.76,249.324z" />
                            <path style="fill:#A4A9AD;" d="M196.579,273.871h-12.766v-47.979h28.355v10.403h-15.589v9.156h14.374v10.403h-14.374    L196.579,273.871L196.579,273.871z" />
	</g>
                            <polygon style="fill:#D1D3D3;" points="219.821,50.525 270.346,50.525 219.821,0  " />
</g>
</svg>
 <svg width=" 50" height="50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
<path style="fill:#ECEDEF;" d="M106.324,8.017c-9.446,0-17.102,7.656-17.102,17.102v461.762c0,9.446,7.656,17.102,17.102,17.102  h376.251c9.446,0,17.102-7.656,17.102-17.102V84.977l-76.96-76.96H106.324z" />
<path style="fill:#D9DCDF;" d="M439.819,84.977h59.858l-76.96-76.96v59.858C422.717,77.319,430.373,84.977,439.819,84.977z" />
<path style="fill:#C6CACF;" d="M397.063,196.142H89.222V42.221h307.841c4.722,0,8.551,3.829,8.551,8.551v136.818  C405.615,192.313,401.786,196.142,397.063,196.142z" />
<polygon style="fill:#427FC9;" points="388.512,179.04 12.262,179.04 80.671,110.63 12.262,42.221 388.512,42.221 " />
<path style="fill:#C5E8FA;" d="M166.182,461.228h256.534c4.722,0,8.551-3.829,8.551-8.551v-222.33c0-4.722-3.829-8.551-8.551-8.551  H166.182c-4.722,0-8.551,3.829-8.551,8.551v222.33C157.631,457.399,161.46,461.228,166.182,461.228z" />
<path style="fill:#97CCE8;" d="M183.285,444.125v-222.33h-17.102c-4.722,0-8.551,3.829-8.551,8.551v222.33  c0,4.722,3.829,8.551,8.551,8.551h256.534c4.722,0,8.551-3.829,8.551-8.551v-8.551H183.285z" />
<path d="M499.677,426.489c4.427,0,8.017-3.589,8.017-8.017V84.977c0-2.1-0.863-4.184-2.348-5.668l-76.96-76.96  C426.899,0.863,424.817,0,422.716,0H106.323C92.473,0,81.204,11.268,81.204,25.119v9.086H12.261c-6.987,0-10.616,8.738-5.668,13.685  l62.741,62.741l-62.74,62.741c-4.947,4.947-1.32,13.685,5.668,13.685h68.944v299.825c0,13.851,11.268,25.119,25.119,25.119h376.251  c13.851,0,25.119-11.268,25.119-25.119v-34.205c0-4.427-3.589-8.017-8.017-8.017c-4.427,0-8.017,3.589-8.017,8.017v34.205  c0,5.01-4.076,9.086-9.086,9.086H106.324c-5.01,0-9.086-4.076-9.086-9.086V187.056h51.841c4.427,0,8.017-3.589,8.017-8.017  s-3.589-8.017-8.017-8.017H31.615l54.724-54.724c3.131-3.131,3.131-8.207,0-11.337L31.615,50.238h348.88v120.785H183.285  c-4.427,0-8.017,3.589-8.017,8.017s3.589,8.017,8.017,8.017h205.228c4.427,0,8.017-3.589,8.017-8.017V42.221  c0-4.427-3.589-8.017-8.017-8.017H97.239v-9.086c0-5.01,4.076-9.086,9.086-9.086H414.7v51.841c0,13.851,11.268,25.119,25.119,25.119  h51.841v325.478C491.66,422.9,495.25,426.489,499.677,426.489z M430.732,67.875V27.37l24.795,24.795l24.795,24.795h-40.505  C434.808,76.96,430.732,72.885,430.732,67.875z" />
<path d="M174.734,469.244h239.432c9.136,0,16.568-7.432,16.568-16.568v-222.33c0-9.136-7.432-16.568-16.568-16.568H174.734  c-9.136,0-16.568,7.432-16.568,16.568v222.33C158.166,461.812,165.598,469.244,174.734,469.244z M174.199,230.347  c0-0.295,0.239-0.534,0.534-0.534h239.432c0.295,0,0.534,0.239,0.534,0.534v222.33c0,0.295-0.239,0.534-0.534,0.534H174.734  c-0.295,0-0.534-0.239-0.534-0.534L174.199,230.347L174.199,230.347z" />
<path d="M372.728,359.257c-4.369-0.726-8.498,2.222-9.226,6.59l-4.498,26.99l-6.078-12.154c-2.896-5.793-11.445-5.794-14.34,0  l-6.078,12.154l-4.498-26.99c-0.728-4.367-4.863-7.318-9.226-6.59c-4.367,0.728-7.318,4.858-6.59,9.226l8.551,51.307  c0.547,3.28,3.154,5.944,6.423,6.56c3.48,0.655,7.071-1.124,8.655-4.293l9.932-19.863l9.932,19.863  c1.609,3.218,5.278,4.991,8.799,4.263c3.206-0.662,5.741-3.302,6.279-6.53l8.551-51.307  C380.046,364.115,377.095,359.985,372.728,359.257z" />
<path d="M217.489,272.568H371.41c4.427,0,8.017-3.589,8.017-8.017c0-4.427-3.589-8.017-8.017-8.017H217.489  c-4.427,0-8.017,3.589-8.017,8.017C209.473,268.979,213.062,272.568,217.489,272.568z" />
<path d="M217.489,323.875H371.41c4.427,0,8.017-3.589,8.017-8.017c0-4.427-3.589-8.017-8.017-8.017H217.489  c-4.427,0-8.017,3.589-8.017,8.017C209.473,320.285,213.062,323.875,217.489,323.875z" />
<path d="M217.489,375.182h68.409c4.427,0,8.017-3.589,8.017-8.017c0-4.427-3.589-8.017-8.017-8.017h-68.409  c-4.427,0-8.017,3.589-8.017,8.017C209.473,371.592,213.062,375.182,217.489,375.182z" />
<path d="M217.489,426.489h68.409c4.427,0,8.017-3.589,8.017-8.017c0-4.427-3.589-8.017-8.017-8.017h-68.409  c-4.427,0-8.017,3.589-8.017,8.017C209.473,422.899,213.062,426.489,217.489,426.489z" />
<path d="M311.552,92.994c4.427,0,8.017-3.589,8.017-8.017c0-4.427-3.589-8.017-8.017-8.017h-25.653  c-4.427,0-8.017,3.589-8.017,8.017v51.307c0,4.427,3.589,8.017,8.017,8.017h25.653c4.427,0,8.017-3.589,8.017-8.017  c0-4.427-3.589-8.017-8.017-8.017h-17.637V92.994H311.552z" />
<path d="M260.245,144.301c4.427,0,8.017-3.589,8.017-8.017V84.977c0-4.427-3.589-8.017-8.017-8.017H226.04  c-4.427,0-8.017,3.589-8.017,8.017v51.307c0,4.427,3.589,8.017,8.017,8.017H260.245z M234.057,92.994h18.171v35.273h-18.171V92.994z  " />
<path d="M208.404,136.284v-34.205c0-13.851-11.268-25.119-25.119-25.119h-25.653c-4.427,0-8.017,3.589-8.017,8.017v51.307  c0,4.427,3.589,8.017,8.017,8.017h42.756C204.814,144.301,208.404,140.711,208.404,136.284z M192.37,128.267h-26.722V92.994h17.637  c5.01,0,9.086,4.076,9.086,9.086V128.267z" />
</svg>
                        </MudText>

                            }
                            else
                            {
                                <MudList Style="padding:2em;width:100%;" Dense="true">
                                    @foreach (var file in fileNames)
                                    {
                                        if (file.EndsWith("pdf") || file.EndsWith("doc") || file.EndsWith("docx"))
                                        {
                                            <MudListItem @key="@file">
                                                <MudChip Color="Color.Dark"
                                                         Style="width:60px; overflow:hidden;"
                                                         Text="@(file.Split(".").Last())" />
                                                @file
                                            </MudListItem>
                                        }
                                        else
                                        {
                                            <MudListItem>
                                                <MudChip Color="Color.Dark"
                                                         Style="width:60px; overflow:hidden;"
                                                         Text="error" />
                                                Incorrect file format.Format required : Pdf,Doc,Docx
                                            </MudListItem>

                                        }
                                    }
                                </MudList>
                            }
                        </MudPaperc>
                        <br />
                        <br />
                        <input id="submitUpload" type="submit" class="btn btn-danger-dark" name="signup_submit" value="Отправить" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</EditForm>

@code {

    Duck.Shared.OpenDataBotModel render = new Duck.Shared.OpenDataBotModel();

    async Task Create()
    {
        if (selectedFiles != null)
        {
            foreach (var file in selectedFiles)
            {
                if (file.Name.EndsWith("pdf") || file.Name.EndsWith("docx") || file.Name.EndsWith("doc"))
                {
                    Stream stream = file.OpenReadStream(1000000);
                    MemoryStream ms = new MemoryStream();
                    await stream.CopyToAsync(ms);
                    stream.Close();
                    UploadedFile uploadedFile = new UploadedFile();
                    Guid guid = Guid.NewGuid();
                    uploadedFile.FileName = Convert.ToString(guid) + file.Name;
                    uploadedFile.FileContent = ms.ToArray();
                    ms.Close();
                    await client.PostAsJsonAsync<UploadedFile>("/api/fileupload", uploadedFile);
                    Message = $"{selectedFiles.Count} file(s) uploaded on server";
                    this.StateHasChanged();
                    NavigationManager.NavigateTo("/Result");
                }
            }
        }
        else
        {
            await serv.CreateNewBlogPost(render);
            NavigationManager.NavigateTo("/Result");
        }
    }
    string Message = "No file(s) selected";
    IReadOnlyList<IBrowserFile> selectedFiles;
    string _dragEnterStyle;
    IList<string> fileNames = new List<string>();
    void OnInputFileChanged(InputFileChangeEventArgs e)
    {

        selectedFiles = e.GetMultipleFiles();
        var files = e.GetMultipleFiles();
        fileNames = files.Select(f => f.Name).ToList();

    }
    void Upload()
    {
        //Upload the files here
        Snackbar.Configuration.PositionClass = Defaults.Classes.Position.TopCenter;
        Snackbar.Add("TODO: Upload your files!", Severity.Normal);
    }

}
